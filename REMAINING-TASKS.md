# üìã –û–°–¢–ê–í–®–ò–ï–°–Ø –ó–ê–î–ê–ß–ò: –ß—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

> **–î–∞—Ç–∞:** 22.01.2025  
> **–°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏:** ‚úÖ Phase 1-2 –∑–∞–≤–µ—Ä—à–µ–Ω—ã

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û

- ‚úÖ Phase 1: Preparation (Schema, Services, Migration, Data Migration)
- ‚úÖ Phase 2: Dual-Write (Appointment Service)
- ‚úÖ Phase 3: Feature Flags (—á–∞—Å—Ç–∏—á–Ω–æ)
- ‚úÖ Verification Script

---

## ‚è≥ –ß–¢–û –û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã):

#### 1. –û–±–Ω–æ–≤–∏—Ç—å `auth.service.js` ‚è≥
**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ DOCTOR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å GlobalDoctor + ClinicDoctor

**–ì–¥–µ:** `backend/src/services/auth.service.js` - —Ñ—É–Ω–∫—Ü–∏—è `registerUser()`

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
```javascript
// –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è User —Å role='DOCTOR'
if (userData.role === 'DOCTOR') {
  // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è User:
  // 1. –°–æ–∑–¥–∞—Ç—å GlobalDoctor
  // 2. –°–æ–∑–¥–∞—Ç—å ClinicDoctor –¥–ª—è —ç—Ç–æ–π –∫–ª–∏–Ω–∏–∫–∏
}
```

**–§–∞–π–ª:** `backend/src/services/auth.service.js` (—Å—Ç—Ä–æ–∫–∞ 89)

---

#### 2. –û–±–Ω–æ–≤–∏—Ç—å `user.service.js` ‚è≥
**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—Ä–∞—á–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å GlobalDoctor + ClinicDoctor

**–ì–¥–µ:** `backend/src/services/user.service.js` - —Ñ—É–Ω–∫—Ü–∏–∏:
- `create()` - –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–∞—á
- `createDoctorByClinic()` - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—Ä–∞—á–∞ –∫–ª–∏–Ω–∏–∫–æ–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è User —Å role='DOCTOR' ‚Üí —Å–æ–∑–¥–∞—Ç—å GlobalDoctor + ClinicDoctor

**–§–∞–π–ª:** `backend/src/services/user.service.js` (—Å—Ç—Ä–æ–∫–∏ 116, 400)

---

#### 3. –û–±–Ω–æ–≤–∏—Ç—å `auth.service.js` –¥–ª—è PATIENT ‚è≥
**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ PATIENT —Å–æ–∑–¥–∞–≤–∞—Ç—å GlobalPatient + ClinicPatient

**–ì–¥–µ:** `backend/src/services/auth.service.js` - —Ñ—É–Ω–∫—Ü–∏—è `registerUser()` (—Å—Ç—Ä–æ–∫–∞ 93)

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è Patient ‚Üí —Å–æ–∑–¥–∞—Ç—å GlobalPatient + ClinicPatient

---

### üü° –í–∞–∂–Ω–æ (–¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏):

#### 4. –û–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã ‚è≥
**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç/–æ–±–Ω–æ–≤–ª—è—é—Ç –≤—Ä–∞—á–µ–π –∏–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `backend/src/services/patient.service.js` - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å User/Patient

---

#### 5. Frontend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚è≥
**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å frontend –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –û–±–Ω–æ–≤–∏—Ç—å TypeScript —Ç–∏–ø—ã (`frontend/src/types/api.types.ts`)
- –û–±–Ω–æ–≤–∏—Ç—å services –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ClinicDoctor/ClinicPatient
- –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ)

---

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ):

#### 6. Phase 3-5: Gradual Switch ‚è≥
- –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π
- Cleanup

---

## üìä –ü–†–ò–û–†–ò–¢–ï–¢–´

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å):
1. ‚úÖ ~~–û–±–Ω–æ–≤–∏—Ç—å auth.service.js –¥–ª—è DOCTOR~~ ‚Üí –°–¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å
2. ‚úÖ ~~–û–±–Ω–æ–≤–∏—Ç—å user.service.js –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–∞—á–µ–π~~ ‚Üí –°–¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å
3. ‚úÖ ~~–û–±–Ω–æ–≤–∏—Ç—å auth.service.js –¥–ª—è PATIENT~~ ‚Üí –°–¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
4. –û–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã (patient.service.js –∏ —Ç.–¥.)
5. Frontend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
6. Phase 3-5 (gradual switch)

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

–ù–∞—á–Ω–µ–º —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á:
1. –û–±–Ω–æ–≤–∏—Ç—å `auth.service.js` –¥–ª—è DOCTOR
2. –û–±–Ω–æ–≤–∏—Ç—å `user.service.js` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–∞—á–µ–π
3. –û–±–Ω–æ–≤–∏—Ç—å `auth.service.js` –¥–ª—è PATIENT

**–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?** üí™


