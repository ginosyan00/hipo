# üí¨ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –í–û–ü–†–û–°–´ –î–õ–Ø –û–ë–°–£–ñ–î–ï–ù–ò–Ø

> **–¶–µ–ª—å:** –û–±—Å—É–¥–∏—Ç—å –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ü–ï–†–ï–î –Ω–∞—á–∞–ª–æ–º implementation

---

## üéØ 1. BACKWARD COMPATIBILITY (API Changes)

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API? Frontend –æ–∂–∏–¥–∞–µ—Ç `doctorId`, –∞ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç `clinicDoctorId`**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: Big Bang (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è MVP)
- ‚úÖ –°—Ä–∞–∑—É –∏–∑–º–µ–Ω–∏—Ç—å –∏ backend, –∏ frontend –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚è±Ô∏è –í—Ä–µ–º—è: 1 –¥–µ–Ω—å

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç production users –∏–ª–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å maintenance window

#### –í–∞—Ä–∏–∞–Ω—Ç B: Backward Compatibility (–¥–ª—è production)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ (`doctorId` –∏ `clinicDoctorId`)
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è frontend
- ‚ùå –ë–æ–ª—å—à–µ –∫–æ–¥–∞ (deprecated endpoints)
- ‚è±Ô∏è –í—Ä–µ–º—è: 2-3 –¥–Ω—è + cleanup –ø–æ–∑–∂–µ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ users –≤ production

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (Big Bang)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (Backward Compatibility)

---

## üéØ 2. MULTI-CLINIC UI (Doctor Experience)

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ù—É–∂–Ω–æ –ª–∏ —Å—Ä–∞–∑—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–ª–∏–Ω–∏–∫–∞–º–∏?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–∑–∂–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ –°–Ω–∞—á–∞–ª–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ backend
- ‚úÖ UI –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
- ‚úÖ –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫–æ–≤
- ‚è±Ô∏è –í—Ä–µ–º—è: Backend migration —Ç–æ–ª—å–∫–æ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ multi-clinic –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ —Å–µ–π—á–∞—Å

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°—Ä–∞–∑—É
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
- ‚úÖ Doctor –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∏–Ω–∏–∫–∞—Ö
- ‚ùå –ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã
- ‚è±Ô∏è –í—Ä–µ–º—è: +1-2 –¥–Ω—è

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ multi-clinic - –∫–ª—é—á–µ–≤–∞—è —Ñ–∏—á–∞

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ü–æ–∑–∂–µ)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–°—Ä–∞–∑—É)

**UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è multi-clinic:**
- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–ª–∏–Ω–∏–∫–∏ –≤ header
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–ª–∏–Ω–∏–∫—É
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–ª–∏–Ω–∏–∫–∞–º–∏ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ localStorage)

---

## üéØ 3. PATIENT MATCHING LOGIC

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö GlobalPatient –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ ClinicPatient?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π matching (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```javascript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ClinicPatient:
// 1. –ò—Å–∫–∞—Ç—å GlobalPatient –ø–æ phone/email/DOB
// 2. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
// 3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –õ—É—á—à–∏–π UX

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –ª–æ–≥–∏–∫–∞
- ‚ùå –ú–æ–≥—É—Ç –±—ã—Ç—å false positives (—Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º phone)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä
```javascript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ClinicPatient:
// 1. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö GlobalPatient
// 2. Doctor –≤—ã–±–∏—Ä–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ
```

**–ü–ª—é—Å—ã:**
- ‚úÖ Doctor –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å
- ‚úÖ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ë–æ–ª—å—à–µ –∫–ª–∏–∫–æ–≤
- ‚ùå –•—É–∂–µ UX

#### –í–∞—Ä–∏–∞–Ω—Ç C: –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π
```javascript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ClinicPatient:
// –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π GlobalPatient
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ matching

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ú–Ω–æ–≥–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚ùå –ü–ª–æ—Ö–æ–π UX

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π matching)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–†—É—á–Ω–æ–π –≤—ã–±–æ—Ä)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç C (–í—Å–µ–≥–¥–∞ –Ω–æ–≤—ã–π)

**Matching criteria:**
- [ ] –¢–æ–ª—å–∫–æ phone
- [ ] Phone + email
- [ ] Phone + email + DOB
- [ ] –î—Ä—É–≥–æ–µ: _______________

---

## üéØ 4. MIGRATION STRATEGY

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: –ø–æ—à–∞–≥–æ–≤–æ –∏–ª–∏ –≤—Å–µ —Å—Ä–∞–∑—É?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ—à–∞–≥–æ–≤–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–±–µ–∑ breaking changes)
–®–∞–≥ 2: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
–®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å backend code
–®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å frontend code
–®–∞–≥ 5: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–ª–æ–Ω–∫–∏
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫–æ–≤
- ‚úÖ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç–∫–∞—Ç–∏—Ç—å

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î–æ–ª—å—à–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚ùå –ù—É–∂–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –í–∞—Ä–∏–∞–Ω—Ç B: –í—Å–µ —Å—Ä–∞–∑—É (Big Bang)
```
1. –°–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
3. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Å—å –∫–æ–¥
4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–ª–æ–Ω–∫–∏
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ë–æ–ª—å—à–µ —Ä–∏—Å–∫–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –æ—Ç–∫–∞—Ç–∏—Ç—å

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ü–æ—à–∞–≥–æ–≤–æ)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–í—Å–µ —Å—Ä–∞–∑—É)

---

## üéØ 5. DOCTOR CLINIC_ID HANDLING

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å `User.clinicId` –¥–ª—è DOCTOR role?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –°–¥–µ–ª–∞—Ç—å NULL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```prisma
model User {
  clinicId String?  // NULL –¥–ª—è DOCTOR (–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∏–Ω–∏–∫–∞—Ö)
  // ...
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ Doctor –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ N –∫–ª–∏–Ω–∏–∫–∞—Ö
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É (–Ω–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ User.clinicId –¥–ª—è DOCTOR)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –û—Å—Ç–∞–≤–∏—Ç—å (deprecated)
```prisma
model User {
  clinicId String?  // –û—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è DOCTOR
  // ...
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–µ–Ω—å—à–µ breaking changes
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ "primary clinic"

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ü—É—Ç–∞–Ω–∏—Ü–∞ (–∫–∞–∫–æ–π clinicId –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?)
- ‚ùå –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (NULL –¥–ª—è DOCTOR)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "primary clinic")

---

## üéØ 6. APPOINTMENT MIGRATION

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ appointments?**

### –ü—Ä–æ–±–ª–µ–º–∞:
- –£ –Ω–∞—Å –µ—Å—Ç—å appointments —Å `doctorId` ‚Üí `User`
- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `ClinicDoctor` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ appointment

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```javascript
// –î–ª—è –∫–∞–∂–¥–æ–≥–æ appointment:
// 1. –ù–∞–π—Ç–∏ User –ø–æ doctorId
// 2. –ù–∞–π—Ç–∏ GlobalDoctor –ø–æ userId
// 3. –ù–∞–π—Ç–∏ ClinicDoctor –ø–æ globalDoctorId + clinicId
// 4. –û–±–Ω–æ–≤–∏—Ç—å appointment.clinicDoctorId
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ë—ã—Å—Ç—Ä–æ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ï—Å–ª–∏ doctor —É–¥–∞–ª–µ–Ω ‚Üí –ø—Ä–æ–±–ª–µ–º–∞
- ‚ùå –ï—Å–ª–∏ clinicId –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞

#### –í–∞—Ä–∏–∞–Ω—Ç B: –° –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
```javascript
// –¢–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:
// - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ User —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ GlobalDoctor —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ ClinicDoctor —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å appointment –∫–∞–∫ "needs review"
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ
- ‚úÖ –í–∏–¥–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ appointments

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å edge cases

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–° –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)

---

## üéØ 7. TESTING STRATEGY

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ù–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# 1. –°–æ–∑–¥–∞—Ç—å backup
cp dev.db dev.db.backup

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å migration –Ω–∞ –∫–æ–ø–∏–∏
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
# 4. –ï—Å–ª–∏ OK ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ production
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Unit tests –¥–ª—è migration script
```javascript
// –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è migration —Ñ—É–Ω–∫—Ü–∏–π
test('migrateDoctorData should create GlobalDoctor', () => { });
test('migrateAppointments should update clinicDoctorId', () => { });
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: Integration tests
```javascript
// –¢–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ flow:
// 1. –°–æ–∑–¥–∞—Ç—å User (DOCTOR)
// 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å migration
// 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ GlobalDoctor –∏ ClinicDoctor —Å–æ–∑–¥–∞–Ω—ã
// 4. –°–æ–∑–¥–∞—Ç—å Appointment
// 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ appointment –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ClinicDoctor
```

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ù–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (Unit tests)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç C (Integration tests)
- [ ] –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

---

## üéØ 8. ROLLBACK PLAN

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å?**

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞:

#### –®–∞–≥ 1: Backup
```bash
# –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
cp dev.db dev.db.backup
```

#### –®–∞–≥ 2: –û—Ç–∫–∞—Ç –¥–∞–Ω–Ω—ã—Ö
```bash
# –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
cp dev.db.backup dev.db
```

#### –®–∞–≥ 3: –û—Ç–∫–∞—Ç –∫–æ–¥–∞
```bash
# –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É commit
git checkout <previous-commit>
```

### ü§î –ù—É–∂–µ–Ω –ª–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π rollback plan?
- [ ] –î–∞, –Ω—É–∂–µ–Ω –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω
- [ ] –ù–µ—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ backup

---

## üéØ 9. PERFORMANCE CONSIDERATIONS

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å queries —Å –Ω–æ–≤—ã–º–∏ joins?**

### –ü—Ä–æ–±–ª–µ–º–∞:
- –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ: User ‚Üí GlobalDoctor ‚Üí ClinicDoctor (2 joins)
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ

### –†–µ—à–µ–Ω–∏—è:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò–Ω–¥–µ–∫—Å—ã
```prisma
model ClinicDoctor {
  // ...
  @@index([globalDoctorId])
  @@index([clinicId])
  @@index([globalDoctorId, clinicId])  // Composite index
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
// –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å ClinicDoctor –≤ –ø–∞–º—è—Ç–∏
const clinicDoctorCache = new Map();

async function getClinicDoctor(userId, clinicId) {
  const key = `${userId}-${clinicId}`;
  if (clinicDoctorCache.has(key)) {
    return clinicDoctorCache.get(key);
  }
  // ... fetch from DB
  clinicDoctorCache.set(key, clinicDoctor);
  return clinicDoctor;
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: Eager loading
```javascript
// –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å relations
const appointment = await prisma.appointment.findUnique({
  where: { id },
  include: {
    clinicDoctor: {
      include: {
        globalDoctor: {
          include: { user: true }
        }
      }
    }
  }
});
```

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ò–Ω–¥–µ–∫—Å—ã)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç C (Eager loading)
- [ ] –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

---

## üéØ 10. FRONTEND CHANGES TIMING

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å frontend: –¥–æ, –≤–æ –≤—Ä–µ–º—è, –∏–ª–∏ –ø–æ—Å–ª–µ backend migration?**

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ—Å–ª–µ backend (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
1. Backend migration
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backend
3. Frontend changes
4. Integration testing
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å backend –æ—Ç–¥–µ–ª—å–Ω–æ

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
```
1. Backend migration + Frontend changes –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. Integration testing
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ë–æ–ª—å—à–µ —Ä–∏—Å–∫–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

#### –í–∞—Ä–∏–∞–Ω—Ç C: –î–æ backend (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
1. Frontend changes
2. Backend migration
```

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå Frontend –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ backend migration

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–ü–æ—Å–ª–µ backend)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç C (–î–æ backend)

---

## üéØ 11. DATA VALIDATION DURING MIGRATION

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ö–∞–∫ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏?**

### –ü—Ä–æ–±–ª–µ–º—ã:
- –ß—Ç–æ –µ—Å–ª–∏ —É User –Ω–µ—Ç specialization, –Ω–æ –æ–Ω DOCTOR?
- –ß—Ç–æ –µ—Å–ª–∏ appointment.doctorId –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
- –ß—Ç–æ –µ—Å–ª–∏ clinicId –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç?

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```javascript
// –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
if (!doctor.specialization) {
  throw new Error(`Doctor ${doctor.id} has no specialization!`);
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ú—è–≥–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```javascript
// –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å, –Ω–æ –ø–æ–º–µ—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏
if (!doctor.specialization) {
  console.warn(`Doctor ${doctor.id} has no specialization`);
  // –°–æ–∑–¥–∞—Ç—å ClinicDoctor —Å specialization = null
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
if (!doctor.specialization) {
  doctor.specialization = 'Unknown';
}
```

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–ú—è–≥–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç C (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

---

## üéØ 12. PARTNER ROLE HANDLING

### ‚ùì –í–æ–ø—Ä–æ—Å:
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å PARTNER role? –ù—É–∂–µ–Ω –ª–∏ GlobalPartner/ClinicPartner?**

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- User —Å role='PARTNER' –∏–º–µ–µ—Ç organizationName, organizationType, inn, address
- –≠—Ç–∏ –ø–æ–ª—è –≤ User table

### –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ Partner –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ù–µ –Ω—É–∂–µ–Ω multi-clinic –¥–ª—è Partner
- ‚úÖ –ú–µ–Ω—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å GlobalPartner/ClinicPartner
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å Doctor/Patient
- ‚ùå –ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã
- ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å over-engineering

### ü§î –í–∞—à –≤—ã–±–æ—Ä?
- [ ] –í–∞—Ä–∏–∞–Ω—Ç A (–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å)
- [ ] –í–∞—Ä–∏–∞–Ω—Ç B (–°–æ–∑–¥–∞—Ç—å GlobalPartner/ClinicPartner)

---

## üìã SUMMARY: –ß–¢–û –ù–£–ñ–ù–û –†–ï–®–ò–¢–¨

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (P0):
1. [ ] **Backward Compatibility** - –í–∞—Ä–∏–∞–Ω—Ç A –∏–ª–∏ B?
2. [ ] **Migration Strategy** - –ü–æ—à–∞–≥–æ–≤–æ –∏–ª–∏ Big Bang?
3. [ ] **Doctor clinicId** - NULL –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å?
4. [ ] **Patient Matching** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π, —Ä—É—á–Ω–æ–π, –∏–ª–∏ –≤—Å–µ–≥–¥–∞ –Ω–æ–≤—ã–π?

### –í–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (P1):
5. [ ] **Multi-clinic UI** - –°—Ä–∞–∑—É –∏–ª–∏ –ø–æ–∑–∂–µ?
6. [ ] **Frontend Timing** - –ü–æ—Å–ª–µ backend –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ?
7. [ ] **Data Validation** - –°—Ç—Ä–æ–≥–∞—è, –º—è–≥–∫–∞—è, –∏–ª–∏ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (P2):
8. [ ] **Testing Strategy** - –ö–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –ø–∏—Å–∞—Ç—å?
9. [ ] **Performance** - –ò–Ω–¥–µ–∫—Å—ã, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–ª–∏ eager loading?
10. [ ] **Partner Role** - –û—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å GlobalPartner?

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

–ü–æ—Å–ª–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:

1. ‚úÖ –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å MIGRATION-PLAN.md —Å —É—á–µ—Ç–æ–º —Ä–µ—à–µ–Ω–∏–π
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π implementation plan
4. ‚úÖ –ù–∞—á–∞—Ç—å implementation

---

**–ì–æ—Ç–æ–≤—ã –æ–±—Å—É–¥–∏—Ç—å?** üí¨

